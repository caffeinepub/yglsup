{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-11T19:21:46.804Z",
  "summary": "Diff implements major parts of REQ-17/18/19/20: call media acquisition + error UI, image messages with previews and conversation-list \"Photo\" label, friend request UI flows and friend-gating in frontend, and updated branding image references in UI. One unrelated URL/session parameter utility appears added/modified without being requested. Due to backend diff truncation, some backend-side REQ-19 enforcement/operations cannot be conclusively verified from the provided evidence.",
  "missing_requirements": [
    {
      "id": "REQ-19",
      "requirement": "Backend provides operations to send friend request, list incoming pending requests, accept/reject a request, and list friends; and backend enforces that startConversation, sendMessage, and initiateCall are only allowed between users with an accepted friend relationship.",
      "reason": "Frontend calls/hooks for friend requests/friends exist, but the backend diff snippet is truncated before showing the actual public methods and enforcement points (startConversation/sendMessage/initiateCall). From the visible backend excerpt, only friendship types/storage and an areFriends helper are shown, not the required API surface/enforcement.",
      "evidence": [
        "backend/main.mo (truncated after areFriends helper; no visible public friend-request APIs or enforcement in shown portion)",
        "frontend/src/hooks/useQueries.ts (shows hooks like useFriends/usePendingFriendRequests/etc, implying backend endpoints but not proving they exist)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Added URL parameter + sessionStorage utilities for persisted URL params and hash query parsing.",
      "reason": "Not requested by any of REQ-17/18/19/20 and not mentioned in the BuildRequest constraints/goals.",
      "evidence": [
        "frontend/src/utils/urlParams.ts"
      ]
    }
  ],
  "confidence": 0.55,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/App.tsx",
    "frontend/src/features/auth/NameStartView.tsx",
    "frontend/src/features/calls/CallScreen.tsx",
    "frontend/src/features/calls/useLocalMedia.ts",
    "frontend/src/features/chat/ChatShell.tsx",
    "frontend/src/features/chat/ConversationList.tsx",
    "frontend/src/features/chat/FriendRequestsDialog.tsx",
    "frontend/src/features/chat/MessageComposer.tsx",
    "frontend/src/features/chat/MessageThread.tsx",
    "frontend/src/features/chat/NewChatDialog.tsx",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/utils/urlParams.ts",
    "project_state.json"
  ]
}